# 저혈압 예측 모델 개선 로그

## 개선 진행 현황

### 2024년 개선 작업

#### Phase 1: 문제 진단 ✅
- **문제**: 데이터셋의 모든 라벨이 0 (저혈압 없음)
- **원인**: 저혈압 판정 기준이 너무 엄격 (MAP < 65 mmHg가 60초 이상 지속)
- **실제 데이터**: MAP는 변동이 많지만 이렇게 오래 지속되는 경우 거의 없음

#### Phase 2: 개선 기준 변경 ✅
**원래 기준:**
- MAP < 65 mmHg 기준
- 60초 이상 연속 지속

**개선 기준 (3가지 조건 중 하나 충족):**
1. **조건1**: MAP < 75 mmHg가 10초 이상 지속
2. **조건2**: 샘플의 ≥20% 가 threshold 이하
3. **조건3**: 최소 MAP < (75 - 10) = 65 mmHg

#### Phase 3: 테스트 데이터로 검증 ✅
**결과 (MAX_CASES=100):**
- 라벨 분포: 59.2% Label 0, 40.8% Label 1
- 모델 성능:
  - 정확도: 76%
  - AUC-ROC: 0.801
  - 저혈압 재현율: 78%
  - 저혈압 정밀도: 67%

#### Phase 4: 전체 데이터셋 구축 (진행 중 ⏳)
**현재 상태:**
- 시작 시간: 개선 작업 시작
- 처리 대상: 6388개 전체 케이스
- 진행률: ~2% (110/6388 케이스)
- 예상 완료 시간: ~2시간

**기대 효과:**
- 더 많은 데이터로 더 정확한 모델 학습
- 임상 검증을 위한 충분한 데이터 확보

## 구성 변경 사항

### config.py 수정
```python
# 이전
MAP_THRESHOLD_MMHG = 65
HYPOTENSION_DURATION_SEC = 60

# 현재
MAP_THRESHOLD_MMHG = 75
HYPOTENSION_DURATION_SEC = 10
```

### build_dataset.py 수정
```python
# 이전
MAX_CASES = 100  # 테스트용

# 현재
MAX_CASES = None  # 전체 데이터 처리
```

### data_loader.py 개선
- MAP 데이터 유효성 검사 (0-200 mmHg 범위)
- NaN 값 필터링
- 3-조건 OR 로직으로 저혈압 판정

## 예상 결과

전체 데이터셋 완성 시:
1. **라벨 분포**: 더 균형잡힌 이진 분류 데이터
2. **모델 성능**: 더 높은 일반화 성능 기대
3. **임상 타당성**: 실제 수술 데이터의 저혈압 패턴 반영

---
**상태**: 전체 데이터 구축 진행 중
**마지막 업데이트**: 2024년
