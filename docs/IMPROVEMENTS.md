# 개선 가능한 부분

## 1. 학습·모델 (성능)

| 항목 | 현재 | 개선 방향 |
|------|------|------------|
| **에폭** | 1 에폭만 (데이터 1회 순회) | 여러 에폭 + 검증 손실 모니터링, early stopping |
| **클래스 불균형** | BCEWithLogitsLoss만 사용 | `pos_weight` 또는 가중치 부여로 저혈압(소수 클래스) 강조 |
| **입력 스케일** | 원본 값 그대로 (MAP 60~120, HR 50~100 등) | StandardScaler 등으로 특성 표준화 후 학습 |
| **모델 크기** | 64→32→1 소형 MLP | 필요 시 층/유닛 확대, BatchNorm 시도 |
| **검증** | 학습 중 검증 없음 | validation set 분리 후 에폭별 AUC/손실 기록, best 체크포인트 저장 |
| **학습률** | 고정 1e-3 | ReduceLROnPlateau 등 스케줄러로 조정 |

## 2. 데이터

| 항목 | 현재 | 개선 방향 |
|------|------|------------|
| **train/test 분할** | 행(row) 단위 무작위 분할 | **케이스(caseid) 단위 분할** → 같은 환자가 train/test에 동시에 있지 않게 (데이터 누수 방지) |
| **특성** | MAP·HR의 mean, std, min만 | SBP/DBP, 추세(기울기), 최대값, 구간별 통계 등 추가 |
| **MAX_CASES** | 500으로 제한 가능 | 전체 사용 시 `None`, 문서에 명시 |
| **표준화** | 없음 | 구축 단계에서 평균/표준편차 저장, 학습 시 동일 스케일 적용 |

## 3. 평가

| 항목 | 현재 | 개선 방향 |
|------|------|------------|
| **분할** | 1회 train_test_split | K-Fold 또는 반복 분할로 성능 분산·구간 추정 |
| **임계값** | 0.5 고정 | F1 또는 Youden 지수 최대화 임계값 탐색 |
| **저혈압 Recall** | 0.41~0.51 수준 | 위 학습·데이터 개선으로 저혈압 검출률 향상 목표 |

## 4. 코드·운영

| 항목 | 현재 | 개선 방향 |
|------|------|------------|
| **경로** | config에 VitalDB 경로 하드코딩 | 환경 변수(예: `VITALDB_ROOT`) 지원, 기본값 유지 |
| **체크포인트** | model_state만 저장 | `feature_cols` 이름·표준화 파라미터 함께 저장 → 추론 시 동일 전처리 |
| **재현성** | RANDOM_STATE만 사용 | `torch.manual_seed`, `numpy.random.seed` 고정 |
| **로깅** | print만 사용 | 로그 파일 기록 또는 Python logging 모듈 사용 |

---

## 우선 적용 권장 (효과 대비 구현 난이도)

1. ~~**클래스 가중치(pos_weight)**~~ ✅ 적용됨
2. ~~**케이스 단위 train/test 분할**~~ ✅ 적용됨
3. ~~**특성 표준화**~~ ✅ 적용됨
4. ~~**다중 에폭 + 검증**~~ ✅ 적용됨 (config: `N_EPOCHS`, `VAL_RATIO`)
5. ~~**특성 확장**~~ ✅ 적용됨 (SBP/DBP, max, trend; **데이터셋 재구축 필요**)

이 문서는 `IMPROVEMENTS.md`로 저장되어 있으며, 위 항목부터 순서대로 적용해 나가면 됩니다.
